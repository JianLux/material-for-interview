# 小卡片的优化思路整理

标签（空格分隔）： project
---

背景：
1. 封装了小卡片展示设备的实时信息，有多种设备： 电流电压表，WiFi探测器，可燃气体
2. 甲方需求不分页，下拉展示所有设备
3. 后台是分别返回所有设备的数组
4. 旧系统数据导过来之后，树的大节点接近三千多个设备同时渲染，很卡，得25秒。

前期思考：
1. 看别人的方案
2. 采用虚拟列表（懒加载）的方案，计算用户视野区域内的数据

难点：计算视野内的小卡片数据
1. 虚拟列表的方案是一行一个数据的，但是小卡片采用的是自适应布局，一行多个数据
2. 考虑过渡状态，也就是视野处于不同设备之间
3. 换行

具体实现：
1. 计算总高度撑开
2. 利用滚动轴的高度判断视野第一个卡片
3. 利用各个数组的长度，计算范围
4. 投入渲染
5. 节流，防抖

结果： 几乎在后台返回数据的瞬间渲染出来，再也不卡了

在这个过程中学到的东西：
1. 思考能力
2. 虚拟列表的思想，也就是懒加载的思想
3. 对性能优化的理解更加深了
4. 踩的小坑： vue的双向绑定
5. 细节范围内的东西：换行，多渲染一行





